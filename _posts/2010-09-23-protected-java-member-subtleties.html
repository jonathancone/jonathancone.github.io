---
layout: post
title: Protected Java Member Subtleties
date: '2010-09-23T22:53:00.000-05:00'
author: Jonathan Cone
tags: 
modified_time: '2010-09-23T22:53:00.973-05:00'
blogger_id: tag:blogger.com,1999:blog-850212609563989685.post-5215143357441409947
blogger_orig_url: http://www.machineversus.me/2010/09/protected-java-member-subtleties.html
---

Every legitimate Java developer knows there's four access levels and three access modifier keywords in Java. &nbsp;If you were an instructor and had to pick one to give a quiz on, which one would it be? Ironically, the default level is probably the access level you use the least (cue the sad tuba). &nbsp;But what about protected? &nbsp;Take this subtlety you might not have thought about into consideration.  Here is our superclass:<br /><code><br /><span class="Apple-style-span" style="color: purple;"> package</span> org.iaea;<br /><br /><span class="Apple-style-span" style="color: purple;"> public class</span> EnergySource {<br />&nbsp;&nbsp; &nbsp;<span class="Apple-style-span" style="color: purple;">protected long</span> efficiency;<br />}</code><br /><code><br /></code><br />Consider the following variation (1) of a subclass:<br /><br /><code> <span class="Apple-style-span" style="color: purple;"> package</span> org.iaea;<br /><br /><span class="Apple-style-span" style="color: purple;"> public class</span> UraniumBasedReactor <span class="Apple-style-span" style="color: purple;">extends</span> EnergySource {<br /><br />&nbsp;&nbsp; &nbsp;<span class="Apple-style-span" style="color: purple;">public void</span> bringOnline() {<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;EnergySource other = <span class="Apple-style-span" style="color: purple;">new</span> EnergySource();<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-style-span" style="color: purple;">this</span>.efficiency = 0;<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;other.efficiency = 12; <span class="Apple-style-span" style="color: #93c47d;">// Works Fine!</span><br />&nbsp;&nbsp; &nbsp;}<br /><br />}<br /></code><br />and now this one (2):<br /><code><br /><span class="Apple-style-span" style="color: purple;"> package</span> org.iaea.uranium;<br /><br /><span class="Apple-style-span" style="color: purple;"> import</span> org.iaea.EnergySource;<br /><br /><span class="Apple-style-span" style="color: purple;"> public class</span> UraniumBasedReactor <span class="Apple-style-span" style="color: purple;">extends </span>EnergySource {<br /><br />&nbsp;&nbsp; &nbsp;<span class="Apple-style-span" style="color: purple;">public void </span>bringOnline() {<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;EnergySource other = <span class="Apple-style-span" style="color: purple;">new </span>EnergySource();<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-style-span" style="color: purple;">this</span>.efficiency = 0;<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;other.efficiency = 12; <span class="Apple-style-span" style="color: #93c47d;">// Compile Error!</span><br />&nbsp;&nbsp; &nbsp;}<br /><br />}<br /></code><br /><br />Notice that the only difference is the subclass package in the second variation leading to a compile error. &nbsp;The IS-A <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">EnergySource</span> relationship still holds for our subclass, but we can't see protected members of other instances any more. &nbsp;In this case, let's check the Java Language Spec:<br /><br /><i><b>6.6.2 Details on protected Access</b><br />A protected member or constructor of an object may be accessed from outside the package in which it is declared only by code that is responsible for the implementation of that object.<br /><span class="Apple-style-span" style="font-style: normal;"><br /></span></i><br /><i><span class="Apple-style-span" style="font-style: normal;">This seems confusing at first. &nbsp;Some of the other sections of the spec seem to imply that both of these examples are valid:</span></i><br /><br /><b><i>6.6.2.1 Access to a protected Member</i></b><br /><i>Let C be the class in which a protected member m is declared. Access is permitted only within the body of a subclass S of C. In addition, if Id denotes an instance field or instance method, then:</i><ul><li><i>If the access is by a qualified name Q.Id, where Q is an ExpressionName, then the access is permitted if and only if the type of the expression Q is S or a subclass of S.</i></li><li><i>If the access is by a field access expression E.Id, where E is a Primary expression, or by a method invocation expression E.Id(. . .), where E is a Primary expression, then the access is permitted if and only if the type of E is S or a subclass of S.</i></li></ul>Certainly, one could argue that the second clause of 6.6.2.1 holds true for our case as it only stipulates types, not instances. &nbsp;However, the key here is figuring out what&nbsp;<i>code that is responsible for the implementation of that object&nbsp;(6.6.2)&nbsp;</i>means. &nbsp;Well evidently, it means that since <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">other</span>&nbsp;is not the same instance as <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">this</span><span class="Apple-style-span" style="font-family: inherit;">&nbsp;that we don't have access to other's protected members <i>when we're not in the same package</i></span>. &nbsp;Other examples in the JLS seem to support this conclusion as well. &nbsp;However, if you were to ask me to rank the access levels in order of most restrictive to least, I would say:<br /><br /><ul><li>private</li><li>default</li><li>protected</li><li>public</li></ul><br />And generally, <a href="http://download.oracle.com/javase/tutorial/java/javaOO/accesscontrol.html">Sun and Oracle</a> would agree. But this seems to be a corner case where we see that protected actually carries an interesting visibility restriction scenario that none of the other access levels could create.