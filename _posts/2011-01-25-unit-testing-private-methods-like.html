---
layout: post
title: Unit testing private methods like a Software Engineer
date: '2011-01-25T01:02:00.001-06:00'
author: Jonathan Cone
tags: 
modified_time: '2011-01-26T19:48:31.808-06:00'
blogger_id: tag:blogger.com,1999:blog-850212609563989685.post-5134458037586504464
blogger_orig_url: http://www.machineversus.me/2011/01/unit-testing-private-methods-like.html
---

Right now, there are three conventional schools of thought on unit testing private methods:<br /><br /><ol><li>Make the private method protected to facilitate unit testing</li><li>Use some reflective utility to make the private method accessible from the test</li><li>Don't unit test private methods since they aren't part of the public API</li></ol><br />The first two obviously break encapsulation which leads to tight-coupling, which, as we all know, leads to less maintainable code and probably gang violence. &nbsp;Because of this, I consider these solutions to be a hack or a kludge:<br /><br /><a href="http://wordnetweb.princeton.edu/perl/webwn?s=kludge"><span class="Apple-style-span" style="color: red;">(n)&nbsp;</span><b>kludge</b>: a badly assembled collection of parts hastily assembled to serve some particular purpose (often used to refer to computing systems or software that has been badly put together)</a><br /><br />And since the title of the entry contains the phrase '<b>like a Software Engineer</b>', we'll distance ourselves from either of these approaches. <br /><br />But before we get too far, if you're working with properly defined abstractions the third approach is actually viable. &nbsp;If you have cohesive classes that follow the <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a>, your private methods can probably be implemented by public methods on another class. &nbsp;Read that sentence again if you didn't understand it the first time. &nbsp;I've heard engineers say things along the lines of "<b>That's great, but it doesn't really work in my scenario.</b>" &nbsp;Generally, this is an indication that the abstraction needs to be reevaluated, and likely refactored into more <a href="http://en.wikipedia.org/wiki/Granularity">granular</a> chunks of complexity.<br /><br />Now, if you still want to unit test a private method, <i>there is another method you can use that won't break your black box</i>. &nbsp;Let's walk through an example. &nbsp;Note that this is extremely contrived, but I hope you can see how the principle applies:<br /><br /><b>1) Examine your production code.</b> &nbsp;In this case we have a <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">Calculator&nbsp;</span>class with a private square method we want to test which is being called from getSquare:<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">public class Calculator {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;...</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;public String getSquare(int x) {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;return "The square of the number is: " + square(x);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;}</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;...</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;private int square(int x) {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;return x * x;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;}</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;...</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br /><b>2) Create a test class to test the public interface.</b>&nbsp;Our public interface is the getSquare method&nbsp;of the Calculator class:<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">public class CalculatorTest {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;Calculator calc = new Calculator();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;@Test</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;public void getSquareOf6() {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;// TODO</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;}</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br /><b>3) Create a method in your test class that has the same implementation contract as the private method you'd like to test.</b>&nbsp;&nbsp;This is the interesting part, the code in your test might even be the same as the private method's production code, but for the sake of the example, its not. &nbsp;We want to emphasize <i>testing the contract semantic, not how the semantic is fulfilled</i>:<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">public class CalculatorTest {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;Calculator calc = new Calculator();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;@Test</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;public void getSquareOf6() {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;// TODO</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;}</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;// Different implementation, same contract semantics</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;private int doSquare(int number) {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;int x = 0;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;for(int i = 0; i &lt; number; i++) {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp; &nbsp;x += number; &nbsp; &nbsp; </span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;}</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;return x; </span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;}</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br /><b>4) Create a series of tests to test the new method you've created. &nbsp;</b>This will ensure that you've validated the correctness of your implementation. &nbsp;<i>These are the unit tests for your private method.</i> &nbsp;Didn't catch that? &nbsp;Well, you're going to test your private method by testing a <b>completely different</b> method and comparing the results of the well-tested method with the results of your untested private production code method.<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">public class CalculatorTest {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;Calculator calc = new Calculator();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;@Test</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;public void getSquareOf6() {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;// TODO</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;}</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;private int doSquare(int number) {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;int x = 0;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;for(int i = 0; i &lt; number; i++) {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp; &nbsp;x += number; &nbsp; &nbsp; </span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;}</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;return x; </span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;}</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;@Test</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;public void doSquare2() {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;Assert.assertEquals(4, doSquare(2));</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;}</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;@Test</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;public void doSquare4() {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;Assert.assertEquals(16, doSquare(4));</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;}&nbsp;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;// More tests</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br />5) At this point, we're pretty confident in the code we wrote within the test class, <b>but we still have yet to test our private method through the public interface provided by the production class</b>:<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">public class CalculatorTest {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;Calculator calc = new Calculator();</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;@Test</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;public void getSquareOf6() {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>// expected, actual</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;Assert.assertEquals("The square of the number is: " + doSquare(6), calc.getSquare(6));</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;}</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><br /></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;private int doSquare(int number) {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;int x = 0;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;for(int i = 0; i &lt; number; i++) {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp; &nbsp;x += number; &nbsp; &nbsp; </span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;}</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp;return x; </span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;}</span><br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;// Other tests, etc. truncated for clarity</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">}</span><br /><br />In summary, we've tested the public interface of our production code, but we've also <b>written tested code</b> to validate the implementation of the public method <i>without</i> exposing the implementation details. &nbsp;As I mentioned, generally its preferable to ensure that you're using the proper abstractions, in this contrived case the number squaring behavior might have been abstracted behind a class that implements behaviors dealing with exponents. &nbsp;Also, our public method was pretty straight forward as well. &nbsp;Your method might return a more complex object, but this technique will still apply.<br /><br />This method may also take a little practice, but I think you can see the benefit provided by preserving encapsulation and the correct abstraction supplied by the interface of the public class.